// Generated by CoffeeScript 1.9.0
(function() {
  var Filter,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __hasProp = {}.hasOwnProperty;

  Filter = (function(_super) {
    __extends(Filter, _super);

    function Filter(_at_app, _at_params, _at_data, _at_city, _at_helpers) {
      var combinedData, self;
      this.app = _at_app;
      this.params = _at_params;
      this.data = _at_data;
      this.city = _at_city;
      this.helpers = _at_helpers;
      self = this;
      this.dataMonthly = _.findWhere(this.data, {
        dimension: this.params.dimension,
        chart: 'monthly'
      });
      this.dataTime = _.findWhere(this.data, {
        dimension: this.params.dimension,
        chart: 'time_of_day'
      });
      this.el = this.params.el;
      combinedData = this.dataMonthly.data.concat(this.dataTime.data);
      this.scaleX = this._getScaleX(combinedData);
      this.monthFormat = d3.time.format("%b");
      this.dataMonthly = this.dataMonthly.data;
      this.buttonsMonthly = d3.select("#filter-month-buttons").append("div");
      this.buttonsMonthly.selectAll("button").data(this.dataMonthly).enter().append("div").append("button").attr("type", "button").attr("class", "btn btn-default btn-sm btn-compact").style("width", "65px").style("margin-bottom", "1px").html((function(_this) {
        return function(d) {
          return _this.monthFormat(new Date(d.date));
        };
      })(this));
      this.chartMonthly = d3.select("#filter-month-chart").append("div").style("width", "112px");
      this.barsMonthly = this.chartMonthly.selectAll(".bar").data(this.dataMonthly).enter().append("div").attr("class", "bar").style("height", "16px").style("background", "#ddd").style("margin-bottom", "5px").style("width", (function(_this) {
        return function(d) {
          return (_this.scaleX(d.median)) + "px";
        };
      })(this));
      this.dataTime = this.dataTime.data;
      this.buttonsTime = d3.select("#filter-time-buttons").append("div");
      this.buttonsTime.selectAll("button").data(this.dataTime).enter().append("div").append("button").attr("type", "button").attr("class", "btn btn-default btn-sm btn-compact").style("width", "65px").style("margin-bottom", "1px").html((function(_this) {
        return function(d) {
          return d.name;
        };
      })(this));
      this.chartMonthly = d3.select("#filter-time-chart").append("div").style("width", "112px");
      this.barsMonthly = this.chartMonthly.selectAll(".bar").data(this.dataTime).enter().append("div").attr("class", "bar").style("height", "16px").style("background", "#ddd").style("margin-bottom", "5px").style("width", (function(_this) {
        return function(d) {
          return (_this.scaleX(d.median)) + "px";
        };
      })(this));
    }

    Filter.prototype._filterCharts = function() {
      var self;
      self = this;
      return $.ajax({
        url: "/update/",
        data: {
          'filters': [
            {
              'type': 'month',
              'value': 'February'
            }, {
              'type': 'time_of_day',
              'value': '5pm to 7pm'
            }
          ]
        }
      }).done(function(data) {
        console.log(data);
        return self.app.update(data);
      });
    };

    Filter.prototype._getScaleX = function(data) {
      var domainX, rangeX;
      domainX = this._getDomain(data);
      rangeX = [0, this.params.width - (this.params.margin.left + this.params.margin.right)];
      return this.params.scale().domain(domainX).range(rangeX);
    };

    Filter.prototype._getDomain = function(data) {
      var max;
      max = _.max(_.pluck(data, "median"));
      return [0, max];
    };

    Filter.prototype.update = function(data) {
      var self;
      self = this;
      this.data = data;
      return this.scaleX = this._getScaleX();
    };

    return Filter;

  })(APP.charts['Chart']);

  APP.charts['Filter'] = Filter;

}).call(this);
